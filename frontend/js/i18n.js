const I18N_MESSAGES = {
  zh: {
    "lang.zh": "中文",
    "lang.en": "English",
    "index.title": "Cloud Media 工具站",
    "index.group": "工具分区",
    "index.menu.video": "视频工具",
    "index.menu.doc": "文档工具",
    "index.menu.more": "更多功能（预留）",
    "index.hero.desc": "无需登录，直接上传并使用视频播放/文档阅读。你的数据会在无操作 20 分钟后自动清理。",
    "index.video.title": "视频工具",
    "index.video.openRecent": "打开最近视频",
    "index.video.upload": "上传视频",
    "index.video.list": "我的视频",
    "index.doc.title": "文档工具",
    "index.doc.openRecent": "打开最近文档",
    "index.doc.upload": "上传文档",
    "index.doc.list": "我的文档",
    "index.more.title": "更多功能（预留）",
    "index.more.desc": "后续可在这里加入音频处理、格式批量转换、字幕工具等模块。",
    "index.footer.about": "关于",
    "index.footer.contact": "联系",
    "index.footer.privacy": "隐私",
    "index.input.video": "选择视频文件",
    "index.input.doc": "选择文档文件",
    "index.noContent": "暂无内容",
    "index.msg.chooseVideo": "请选择视频文件",
    "index.msg.chooseDoc": "请选择文档文件",
    "index.msg.videoUploaded": "视频上传成功",
    "index.msg.videoUploadFailed": "视频上传失败",
    "index.msg.docUploaded": "文档上传成功",
    "index.msg.docUploadFailed": "文档上传失败",
    "index.msg.deleted": "删除成功",
    "index.msg.deleteFailed": "删除失败",
    "index.msg.loadFailed": "加载失败",
    "index.action.delete": "删除",
    "index.alert.noVideo": "你还没有视频，请先上传。",
    "index.alert.noDoc": "你还没有文档，请先上传。",
    "video.title": "视频播放 - Cloud Media",
    "video.header": "视频播放",
    "common.backHome": "返回首页",
    "common.resetSize": "恢复默认大小",
    "video.msg.missingId": "缺少视频 ID",
    "video.msg.loadFailed": "加载失败",
    "doc.title": "文档阅读 - Cloud Media",
    "doc.header": "文档阅读",
    "doc.msg.missingId": "缺少文档 ID",
    "about.title": "关于 - Cloud Media Tools",
    "about.header": "关于",
    "about.p1": "Cloud Media Tools 是一个公开可访问的在线工具站，提供视频播放与文档预览功能。",
    "about.p2": "无需注册登录，用户可直接上传并处理个人内容。",
    "about.p3": "访客数据会在无操作 20 分钟后自动清理。",
    "contact.title": "联系 - Cloud Media Tools",
    "contact.header": "联系",
    "contact.email": "邮箱：",
    "contact.p1": "如需内容下架或问题反馈，请通过邮箱联系。",
    "privacy.title": "隐私政策 - Cloud Media Tools",
    "privacy.header": "隐私政策",
    "privacy.p1": "本网站为公开工具站，默认不要求用户注册登录。",
    "privacy.p2": "站点会使用 LocalStorage 保存匿名访客 ID，用于隔离每位访客的数据。",
    "privacy.p3": "站点可能记录基础访问日志用于安全审计和故障排查。",
    "privacy.p4": "如果接入广告服务（如 Google AdSense），可能使用 Cookie 或类似技术用于广告展示与效果统计。",
    "privacy.p5": "访客上传数据将在无操作 20 分钟后自动删除。"
  },
  en: {
    "lang.zh": "中文",
    "lang.en": "English",
    "index.title": "Cloud Media Tools",
    "index.group": "Tool Categories",
    "index.menu.video": "Video Tools",
    "index.menu.doc": "Document Tools",
    "index.menu.more": "More Features (Reserved)",
    "index.hero.desc": "No login required. Upload and use video/document tools directly. Your data is automatically cleaned after 20 minutes of inactivity.",
    "index.video.title": "Video Tools",
    "index.video.openRecent": "Open Latest Video",
    "index.video.upload": "Upload Video",
    "index.video.list": "My Videos",
    "index.doc.title": "Document Tools",
    "index.doc.openRecent": "Open Latest Document",
    "index.doc.upload": "Upload Document",
    "index.doc.list": "My Documents",
    "index.more.title": "More Features (Reserved)",
    "index.more.desc": "You can add audio processing, batch conversion, subtitle tools and more here later.",
    "index.footer.about": "About",
    "index.footer.contact": "Contact",
    "index.footer.privacy": "Privacy",
    "index.input.video": "Choose a video file",
    "index.input.doc": "Choose a document file",
    "index.noContent": "No content yet",
    "index.msg.chooseVideo": "Please choose a video file",
    "index.msg.chooseDoc": "Please choose a document file",
    "index.msg.videoUploaded": "Video uploaded successfully",
    "index.msg.videoUploadFailed": "Video upload failed",
    "index.msg.docUploaded": "Document uploaded successfully",
    "index.msg.docUploadFailed": "Document upload failed",
    "index.msg.deleted": "Deleted successfully",
    "index.msg.deleteFailed": "Delete failed",
    "index.msg.loadFailed": "Load failed",
    "index.action.delete": "Delete",
    "index.alert.noVideo": "No video yet. Please upload first.",
    "index.alert.noDoc": "No document yet. Please upload first.",
    "video.title": "Video Player - Cloud Media",
    "video.header": "Video Player",
    "common.backHome": "Back to Home",
    "common.resetSize": "Reset Size",
    "video.msg.missingId": "Missing video ID",
    "video.msg.loadFailed": "Load failed",
    "doc.title": "Document Viewer - Cloud Media",
    "doc.header": "Document Viewer",
    "doc.msg.missingId": "Missing document ID",
    "about.title": "About - Cloud Media Tools",
    "about.header": "About",
    "about.p1": "Cloud Media Tools is a public online utility website for video playback and document preview.",
    "about.p2": "No account is required. Visitors can upload and process their own content directly.",
    "about.p3": "Visitor data is automatically cleaned after 20 minutes of inactivity.",
    "contact.title": "Contact - Cloud Media Tools",
    "contact.header": "Contact",
    "contact.email": "Email:",
    "contact.p1": "For takedown requests or issue reports, please contact us by email.",
    "privacy.title": "Privacy Policy - Cloud Media Tools",
    "privacy.header": "Privacy Policy",
    "privacy.p1": "This website is public and does not require user registration by default.",
    "privacy.p2": "The site uses LocalStorage to store an anonymous guest ID for per-visitor data isolation.",
    "privacy.p3": "Basic access logs may be recorded for security auditing and troubleshooting.",
    "privacy.p4": "If ad services are enabled in the future (for example, Google AdSense), cookies or similar technologies may be used.",
    "privacy.p5": "Uploaded visitor data will be deleted after 20 minutes of inactivity."
  }
};

function getLanguage() {
  const saved = localStorage.getItem("lang");
  if (saved === "zh" || saved === "en") return saved;
  return (navigator.language || "").toLowerCase().startsWith("zh") ? "zh" : "en";
}

function t(key, fallback = "") {
  const lang = window.__lang || getLanguage();
  return I18N_MESSAGES[lang]?.[key] || fallback || key;
}

function applyI18n(lang) {
  window.__lang = lang;
  localStorage.setItem("lang", lang);
  document.documentElement.lang = lang === "zh" ? "zh-CN" : "en";

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const text = t(key, el.textContent);
    el.textContent = text;
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    const text = t(key, el.getAttribute("placeholder") || "");
    el.setAttribute("placeholder", text);
  });

  document.querySelectorAll("[data-lang-switch]").forEach((btn) => {
    btn.classList.toggle("active", btn.dataset.langSwitch === lang);
  });

  window.dispatchEvent(new Event("languagechange"));
}

function bindLangSwitch() {
  document.querySelectorAll("[data-lang-switch]").forEach((btn) => {
    btn.addEventListener("click", () => {
      applyI18n(btn.dataset.langSwitch);
    });
  });
}

window.t = t;
window.applyI18n = applyI18n;
bindLangSwitch();
applyI18n(getLanguage());
